# 数据库修复步骤

## 🐛 问题原因

错误信息：`no such column: user.email`

**原因：** 数据库表是之前创建的，当时模型中没有 `email` 等字段。后来我们更新了模型添加了新字段，但数据库表结构没有更新。

## ✅ 解决方法：重新创建数据库

### 步骤1：停止后端服务

在后端终端按 `Ctrl+C` 停止服务

### 步骤2：删除旧的数据库文件

```bash
cd /Users/lixiang/PycharmProjects/PythonProject
rm test.db
```

或者手动删除：
- 找到 `test.db` 文件
- 删除它

### 步骤3：重新启动后端服务

```bash
python main.py
```

后端启动时会自动创建新的数据库表结构（包含所有字段）。

### 步骤4：验证

看到类似以下日志说明表创建成功：
```
INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
INFO sqlalchemy.engine.Engine PRAGMA main.table_info("work")
INFO sqlalchemy.engine.Engine PRAGMA main.table_info("consumptionrecord")
```

## 📋 完整的操作命令

```bash
# 1. 停止后端服务（如果正在运行）
# 按 Ctrl+C

# 2. 删除旧数据库
cd /Users/lixiang/PycharmProjects/PythonProject
rm test.db

# 3. 重新启动后端
python main.py
```

## ⚠️ 注意事项

- **删除数据库会丢失所有数据**（包括之前注册的用户）
- 这是开发环境的正常操作
- 生产环境应该使用数据库迁移工具（如 Alembic）

## ✅ 验证修复

重新启动后，再次测试注册功能，应该可以正常工作了。

