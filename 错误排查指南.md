# 500é”™è¯¯æ’æŸ¥æŒ‡å—

## ğŸ” æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

**æœ€é‡è¦çš„ä¸€æ­¥ï¼šæŸ¥çœ‹åç«¯ç»ˆç«¯çš„å®Œæ•´é”™è¯¯ä¿¡æ¯ï¼**

åç«¯ç»ˆç«¯ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œè¿™æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚

### å¦‚ä½•æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š

1. **æ‰¾åˆ°è¿è¡Œåç«¯çš„ç»ˆç«¯çª—å£**
2. **æŸ¥çœ‹æœ€æ–°çš„é”™è¯¯æ—¥å¿—**ï¼ˆé€šå¸¸åœ¨è¯·æ±‚æ—¥å¿—ä¸‹æ–¹ï¼‰
3. **å¤åˆ¶å®Œæ•´çš„é”™è¯¯ä¿¡æ¯**ï¼ˆåŒ…æ‹¬å †æ ˆè·Ÿè¸ªï¼‰

é”™è¯¯ä¿¡æ¯é€šå¸¸ç±»ä¼¼è¿™æ ·ï¼š
```
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "...", line ..., in ...
    ...
å…·ä½“é”™è¯¯ä¿¡æ¯
```

---

## ğŸ› å¸¸è§500é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ³•

### é—®é¢˜1ï¼šæ•°æ®åº“è¡¨æœªåˆ›å»ºæˆ–ç»“æ„ä¸åŒ¹é…

**é”™è¯¯ç‰¹å¾ï¼š**
- `no such table: user` æˆ–ç±»ä¼¼é”™è¯¯
- `OperationalError`

**è§£å†³æ–¹æ³•ï¼š**
1. åˆ é™¤æ—§çš„æ•°æ®åº“æ–‡ä»¶ï¼š
   ```bash
   cd /Users/lixiang/PycharmProjects/PythonProject
   rm test.db
   ```

2. é‡æ–°å¯åŠ¨åç«¯æœåŠ¡ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ï¼‰ï¼š
   ```bash
   python main.py
   ```

### é—®é¢˜2ï¼šå”¯ä¸€çº¦æŸå†²çª

**é”™è¯¯ç‰¹å¾ï¼š**
- `IntegrityError`
- `UNIQUE constraint failed`

**è§£å†³æ–¹æ³•ï¼š**
- å¦‚æœç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¿™æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘ï¼ˆåº”è¯¥è¿”å›400ï¼Œä¸æ˜¯500ï¼‰
- æ£€æŸ¥ä»£ç æ˜¯å¦æ­£ç¡®å¤„ç†äº†è¿™ç§æƒ…å†µ

### é—®é¢˜3ï¼šæ•°æ®åº“ä¼šè¯ç®¡ç†é—®é¢˜

**é”™è¯¯ç‰¹å¾ï¼š**
- `Session is closed`
- `This session is closed`

**è§£å†³æ–¹æ³•ï¼š**
æ£€æŸ¥ `db/database.py` ä¸­çš„ä¼šè¯ç®¡ç†ä»£ç 

### é—®é¢˜4ï¼šå­—æ®µç±»å‹ä¸åŒ¹é…

**é”™è¯¯ç‰¹å¾ï¼š**
- `TypeError`
- `ValueError`

**è§£å†³æ–¹æ³•ï¼š**
æ£€æŸ¥æ¨¡å‹å®šä¹‰å’Œå®é™…æ•°æ®æ˜¯å¦åŒ¹é…

### é—®é¢˜5ï¼šå¯¼å…¥é”™è¯¯æˆ–ä¾èµ–ç¼ºå¤±

**é”™è¯¯ç‰¹å¾ï¼š**
- `ModuleNotFoundError`
- `ImportError`

**è§£å†³æ–¹æ³•ï¼š**
```bash
pip install -r requirements.txt
```

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šæŸ¥çœ‹åç«¯ç»ˆç«¯é”™è¯¯ä¿¡æ¯

**è¿™æ˜¯æœ€å…³é”®çš„æ­¥éª¤ï¼** è¯·æŠŠåç«¯ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯å‘ç»™æˆ‘ã€‚

### æ­¥éª¤2ï¼šå°è¯•é‡æ–°åˆ›å»ºæ•°æ®åº“

```bash
cd /Users/lixiang/PycharmProjects/PythonProject
rm test.db
python main.py
```

### æ­¥éª¤3ï¼šæ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´

```bash
pip install -r requirements.txt
```

### æ­¥éª¤4ï¼šæ·»åŠ é”™è¯¯æ—¥å¿—

å¦‚æœé”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­æ·»åŠ æ›´å¤šæ—¥å¿—ã€‚

---

## ğŸ“‹ è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯

ä¸ºäº†å¿«é€Ÿå®šä½é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **åç«¯ç»ˆç«¯çš„å®Œæ•´é”™è¯¯ä¿¡æ¯**ï¼ˆæœ€é‡è¦ï¼ï¼‰
2. **è¯·æ±‚çš„URLå’Œå‚æ•°**
3. **åç«¯Pythonç‰ˆæœ¬**ï¼š`python --version`
4. **æ˜¯å¦é‡æ–°åˆ›å»ºè¿‡æ•°æ®åº“**

---

## ğŸ’¡ ä¸´æ—¶è°ƒè¯•æ–¹æ³•

å¦‚æœé”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†ï¼Œå¯ä»¥ä¸´æ—¶ä¿®æ”¹ä»£ç æ·»åŠ æ›´å¤šæ—¥å¿—ï¼š

åœ¨ `main.py` çš„æ³¨å†Œå‡½æ•°ä¸­æ·»åŠ ï¼š

```python
@app.post("/api/auth/register", response_model=dict)
def register(data: RegisterRequest, session: Session = Depends(get_session)):
    """ç”¨æˆ·æ³¨å†Œ"""
    try:
        print(f"æ”¶åˆ°æ³¨å†Œè¯·æ±‚: {data.username}, {data.email}")
        # åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
        user = session.exec(select(User).where(User.username == data.username)).first()
        print(f"æŸ¥è¯¢ç”¨æˆ·ç»“æœ: {user}")
        if user:
            raise HTTPException(status_code=400, detail="ç”¨æˆ·åå·²å­˜åœ¨")
        
        # åˆ›å»ºç”¨æˆ·
        new_user = User(
            username=data.username,
            password=data.password,
            email=data.email
        )
        print(f"åˆ›å»ºç”¨æˆ·å¯¹è±¡: {new_user}")
        session.add(new_user)
        session.commit()
        session.refresh(new_user)
        print(f"ç”¨æˆ·åˆ›å»ºæˆåŠŸ: {new_user.id}")
        
        return {
            "code": 200,
            "message": "æ³¨å†ŒæˆåŠŸ",
            "data": {"user_id": new_user.id}
        }
    except Exception as e:
        print(f"æ³¨å†Œé”™è¯¯: {type(e).__name__}: {str(e)}")
        import traceback
        traceback.print_exc()
        raise
```

è¿™æ ·å¯ä»¥åœ¨åç«¯ç»ˆç«¯çœ‹åˆ°è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ã€‚

